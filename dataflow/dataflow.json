{
	"name": "dataflow",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "inventory",
						"type": "DatasetReference"
					},
					"name": "inventory",
					"description": "my card inventory"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "mtginventory",
						"type": "DatasetReference"
					},
					"name": "output"
				}
			],
			"transformations": [
				{
					"name": "colourSplit"
				},
				{
					"name": "colourIdentityDerivation",
					"description": "derive colour identity - doesn't handle multicoloured"
				}
			],
			"scriptLines": [
				"source(output(",
				"          Count as string,",
				"          {Tradelist Count} as string,",
				"          Name as string,",
				"          Edition as string,",
				"          {Edition Code} as string,",
				"          {Card Number} as string,",
				"          Condition as string,",
				"          Language as string,",
				"          Foil as string,",
				"          Signed as string,",
				"          {Artist Proof} as string,",
				"          {Altered Art} as string,",
				"          Misprint as string,",
				"          Promo as string,",
				"          Textless as string,",
				"          {Printing Id} as string,",
				"          {Printing Note} as string,",
				"          Tags as string,",
				"          {My Price} as string,",
				"          Type as string,",
				"          Cost as string,",
				"          Rarity as string,",
				"          Price as string,",
				"          {Image URL} as string,",
				"          {Last Updated} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> inventory",
				"colourIdentityDerivation split(Type==\"Land\",",
				"     colourIdentity=='Blue',",
				"     colourIdentity=='Red',",
				"     colourIdentity=='Green',",
				"     colourIdentity=='Black',",
				"     colourIdentity=='White',",
				"     disjoint: false) ~> colourSplit@(Land, Blue, Red, Green, Black, White, Other)",
				"inventory derive(colourIdentity = iif(instr(Cost, 'B')>0, 'Black', \r",
				"    iif(instr(Cost, 'W')>0, 'White', \r",
				"    iif(instr(Cost, 'R')>0, 'Red',\r",
				"    iif(instr(Cost, 'U')>0, 'Blue',\r",
				"    iif(instr(Cost, 'W')>0, 'White', \r",
				"    iif(isNull(Cost), 'Land','Colourless'))))))) ~> colourIdentityDerivation",
				"colourSplit@Other sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError') ~> output"
			]
		}
	}
}